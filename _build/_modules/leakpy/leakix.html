

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>leakpy.leakix &mdash; LeakPy 2.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=16656018"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            LeakPy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fields.html">Available Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">LeakPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">leakpy.leakix</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for leakpy.leakix</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">MIT License</span>

<span class="sd">Copyright (c) 2025 Valentin Lobstein (balgogan@protonmail.com)</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in all</span>
<span class="sd">copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="sd">SOFTWARE.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;Main scraper class for LeakPy.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.progress</span><span class="w"> </span><span class="kn">import</span> <span class="n">BarColumn</span><span class="p">,</span> <span class="n">Progress</span><span class="p">,</span> <span class="n">SpinnerColumn</span><span class="p">,</span> <span class="n">TaskProgressColumn</span><span class="p">,</span> <span class="n">TextColumn</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">helpers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">LeakIXAPI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIKeyManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">ensure_api_initialized</span><span class="p">,</span> <span class="n">process_and_format_data</span>


<span class="c1"># ============================================================================</span>
<span class="c1"># HELPER CLASSES</span>
<span class="c1"># ============================================================================</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DotNotationObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic wrapper class that converts dictionaries to objects with dot notation access.</span>
<span class="sd">    </span>
<span class="sd">    Example:</span>
<span class="sd">        obj = DotNotationObject({&quot;services&quot;: [...], &quot;leaks&quot;: [...]})</span>
<span class="sd">        print(obj.services)  # Access with dot notation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize DotNotationObject with a dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            data (dict): Dictionary to convert to object with dot notation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert value to DotNotationObject if it&#39;s a dict, otherwise return as-is.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">DotNotationObject</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_value</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">value</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return None for missing attributes to allow safe chaining.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation for debugging.&quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)}</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DotNotationObject(</span><span class="si">{</span><span class="n">attrs</span><span class="si">}</span><span class="s2">)&quot;</span>


<span class="c1"># ============================================================================</span>
<span class="c1"># MAIN CLASS</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="LeakIX">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LeakIX</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main class for interacting with LeakIX API.&quot;&quot;&quot;</span>
    
    <span class="c1"># Default number of pages for search queries</span>
    <span class="n">DEFAULT_PAGES</span> <span class="o">=</span> <span class="mi">2</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a new instance of LeakIX.</span>

<span class="sd">        Args:</span>
<span class="sd">            api_key (str, optional): The API key for accessing LeakIX services. Defaults to None.</span>
<span class="sd">            silent (bool, optional): Flag to suppress all output (no logs, no progress bar). Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">silent</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">_DEFAULT_LOGGER_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="n">_DEFAULT_LOGGER_NAME</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_manager</span> <span class="o">=</span> <span class="n">APIKeyManager</span><span class="p">()</span>

        <span class="n">api_key_read</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_manager</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_manager</span><span class="o">.</span><span class="n">migrate_old_location</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">api_key_read</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key_manager</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>
        <span class="c1"># In silent mode, pass a no-op logger to API</span>
        <span class="n">api_logger</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">silent</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">LeakIXAPI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">api_logger</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="LeakIX.log">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.log">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log messages with proper formatting.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (str): Message to log.</span>
<span class="sd">            level (str): Log level (info, debug, warning, error).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">normalized_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">message</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">log_func</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_log_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="n">log_func</span><span class="p">(</span><span class="n">normalized_message</span><span class="p">)</span></div>


<div class="viewcode-block" id="LeakIX.has_api_key">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.has_api_key">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if an API key is available and valid (48 characters).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_manager</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_manager</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span></div>

    
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_console_for_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create console for rich progress output.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Console</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;stderr&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_suppress_debug_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suppress debug logging and return original level.&quot;&quot;&quot;</span>
        <span class="n">original_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># logging.INFO</span>
        <span class="k">return</span> <span class="n">original_level</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_restore_logging_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_level</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restore original logging level.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">original_level</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_should_use_progress_bulk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_data_only</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if progress should be shown in bulk mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">return_data_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">output_file</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_should_use_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_data_only</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if progress should be shown in regular mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">return_data_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_rate_limit_sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_cached</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sleep for rate limit if not cached.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_cached</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">_RATE_LIMIT_SLEEP</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_RATE_LIMIT_SLEEP</span><span class="p">)</span>

<div class="viewcode-block" id="LeakIX.save_api_key">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.save_api_key">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the API key securely for later use.</span>

<span class="sd">        Args:</span>
<span class="sd">            api_key (str): The API key to be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_manager</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="c1"># Reinitialize API client with new key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">ensure_api_initialized</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="LeakIX.delete_api_key">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.delete_api_key">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the stored API key from secure storage.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_manager</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="LeakIX.get_plugins">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.get_plugins">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the list of available plugins from LeakIX.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_plugins</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="k">else</span> <span class="p">[]</span></div>

    
<div class="viewcode-block" id="LeakIX.get_cache_stats">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.get_cache_stats">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cache_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get cache statistics.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            DotNotationObject: Object containing cache statistics with attributes:</span>
<span class="sd">                - total_entries (int): Total number of cache entries</span>
<span class="sd">                - active_entries (int): Number of active (non-expired) entries</span>
<span class="sd">                - expired_entries (int): Number of expired entries</span>
<span class="sd">                - ttl_seconds (int): Current TTL in seconds</span>
<span class="sd">                - ttl_minutes (int): Current TTL in minutes</span>
<span class="sd">                - configured_ttl_minutes (int or None): Configured TTL in minutes</span>
<span class="sd">                - cache_file_size (int): Size of cache file in bytes</span>
<span class="sd">                - cache_file_path (str): Path to cache file</span>
<span class="sd">                - oldest_entry_age (float): Age of oldest entry in seconds</span>
<span class="sd">                - newest_entry_age (float): Age of newest entry in seconds</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client = LeakIX()</span>
<span class="sd">            &gt;&gt;&gt; stats = client.get_cache_stats()</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Cache has {stats.total_entries} entries&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DotNotationObject</span><span class="p">(</span><span class="n">helpers</span><span class="o">.</span><span class="n">get_cache_stats</span><span class="p">())</span></div>

    
<div class="viewcode-block" id="LeakIX.clear_cache">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.clear_cache">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear all cache entries.</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client = LeakIX()</span>
<span class="sd">            &gt;&gt;&gt; client.clear_cache()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">APICache</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">APICache</span><span class="p">()</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="LeakIX.get_cache_ttl">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.get_cache_ttl">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cache_ttl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current cache TTL in minutes.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            int or None: TTL in minutes, or None if using default.</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client = LeakIX()</span>
<span class="sd">            &gt;&gt;&gt; ttl = client.get_cache_ttl()</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Cache TTL: {ttl} minutes&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheConfig</span>
        <span class="n">cache_config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cache_config</span><span class="o">.</span><span class="n">get_ttl_minutes</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="LeakIX.set_cache_ttl">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.set_cache_ttl">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_cache_ttl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the cache TTL (Time To Live) in minutes.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            minutes (int): TTL in minutes (must be positive).</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If minutes is not a positive integer.</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client = LeakIX()</span>
<span class="sd">            &gt;&gt;&gt; client.set_cache_ttl(10)  # Set TTL to 10 minutes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">minutes</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TTL must be a positive integer (minutes).&quot;</span><span class="p">)</span>
        
        <span class="kn">from</span><span class="w"> </span><span class="nn">.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheConfig</span>
        <span class="n">cache_config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">()</span>
        <span class="n">cache_config</span><span class="o">.</span><span class="n">set_ttl_minutes</span><span class="p">(</span><span class="n">minutes</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="LeakIX.analyze_query_stats">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.analyze_query_stats">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_query_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">all_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze query results and extract statistics.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            results (iterable): Iterable of results (list, generator, etc.) containing dicts or L9Event objects to analyze.</span>
<span class="sd">            fields (str or list, optional): Fields to analyze. Can be:</span>
<span class="sd">                - str: Comma-separated field paths (e.g., &quot;protocol,geoip.country_name&quot;)</span>
<span class="sd">                - list: List of field paths (strings)</span>
<span class="sd">                - None: Uses default fields</span>
<span class="sd">            top (int, optional): Maximum number of top values to return per field.</span>
<span class="sd">                                Defaults to 10.</span>
<span class="sd">            all_fields (bool, optional): If True, analyze all available fields.</span>
<span class="sd">                                        Defaults to False.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            QueryStats: QueryStats object with dot notation access:</span>
<span class="sd">                - total (int): Total number of results</span>
<span class="sd">                - fields (QueryStats): QueryStats object mapping field names to their statistics.</span>
<span class="sd">                  Each field contains a dict mapping values to their counts.</span>
<span class="sd">                  Access with: stats.fields.protocol, stats.fields.port, etc.</span>
<span class="sd">        </span>
<span class="sd">        Examples:</span>
<span class="sd">            Using string field paths::</span>
<span class="sd">            </span>
<span class="sd">                stats = client.analyze_query_stats(events, fields=&#39;protocol,port&#39;)</span>
<span class="sd">            </span>
<span class="sd">            Using list of field paths::</span>
<span class="sd">            </span>
<span class="sd">                stats = client.analyze_query_stats(events, fields=[&#39;protocol&#39;, &#39;geoip.country_name&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_query_results</span>
        
        <span class="c1"># Analyze results</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">analyze_query_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">all_fields</span><span class="p">)</span>
        
        <span class="c1"># Limit to top N values per field</span>
        <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_stats_to_top</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">stats</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_limit_stats_to_top</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">top</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Limit stats to top N values per field.&quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_limit_nested_dict</span><span class="p">(</span><span class="n">fields_dict</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Recursively limit nested dict to top N values.&quot;&quot;&quot;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">fields_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="c1"># Check if this dict contains counts (non-dict values)</span>
                    <span class="k">if</span> <span class="n">helpers</span><span class="o">.</span><span class="n">has_counts</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                        <span class="c1"># This is a leaf dict with counts, limit to top N</span>
                        <span class="n">sorted_items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sorted_items</span><span class="p">[:</span><span class="n">top</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># This is a nested dict, recurse</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_limit_nested_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        
        <span class="n">stats_dict</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">stats_dict</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_limit_nested_dict</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">])</span>
        
        <span class="kn">from</span><span class="w"> </span><span class="nn">.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">QueryStats</span>
        <span class="k">return</span> <span class="n">QueryStats</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_process_services_and_leaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process services and leaks from data and optionally write to file.&quot;&quot;&quot;</span>
        <span class="n">services</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Handle both &quot;Services&quot; (API format) and &quot;services&quot; (normalized)</span>
        <span class="n">services_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;services&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Services&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">services_data</span><span class="p">:</span>
            <span class="n">processed_services</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_and_print_data</span><span class="p">(</span>
                <span class="n">services_data</span><span class="p">,</span> 
                <span class="n">fields</span><span class="p">,</span> 
                <span class="n">suppress_debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">silent</span>
            <span class="p">)</span>
            <span class="n">services</span> <span class="o">=</span> <span class="n">processed_services</span>
            <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">processed_services</span><span class="p">:</span>
                    <span class="n">helpers</span><span class="o">.</span><span class="n">write_json_line</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span>
        
        <span class="n">leaks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Handle both &quot;Leaks&quot; (API format) and &quot;leaks&quot; (normalized)</span>
        <span class="n">leaks_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;leaks&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Leaks&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">leaks_data</span><span class="p">:</span>
            <span class="n">processed_leaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_and_print_data</span><span class="p">(</span>
                <span class="n">leaks_data</span><span class="p">,</span> 
                <span class="n">fields</span><span class="p">,</span> 
                <span class="n">suppress_debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">silent</span>
            <span class="p">)</span>
            <span class="n">leaks</span> <span class="o">=</span> <span class="n">processed_leaks</span>
            <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">leak</span> <span class="ow">in</span> <span class="n">processed_leaks</span><span class="p">:</span>
                    <span class="n">helpers</span><span class="o">.</span><span class="n">write_json_line</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">leak</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">services</span><span class="p">,</span> <span class="n">leaks</span>
    
<div class="viewcode-block" id="LeakIX.get_host">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.get_host">[docs]</a>
    <span class="nd">@helpers</span><span class="o">.</span><span class="n">require_api_key</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_host</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get host details for a specific IP address.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ip (str): The IP address to query.</span>
<span class="sd">            fields (str, optional): Comma-separated list of fields to extract.</span>
<span class="sd">                                    Defaults to &quot;full&quot; to get all details.</span>
<span class="sd">            output (str or file object, optional): Path to file or file object to write results.</span>
<span class="sd">                                                   If None, results are only returned. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            DotNotationObject: Object with &#39;services&#39; and &#39;leaks&#39; attributes, each containing a list of L9Event objects.</span>
<span class="sd">                  Both can be None if no information was found.</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client = LeakIX()</span>
<span class="sd">            &gt;&gt;&gt; host_info = client.get_host(&quot;157.90.211.37&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Services: {len(host_info.services or [])}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Leaks: {len(host_info.leaks or [])}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; # Access service details</span>
<span class="sd">            &gt;&gt;&gt; if host_info.services:</span>
<span class="sd">            ...     for service in host_info.services:</span>
<span class="sd">            ...         print(f&quot;{service.protocol}://{service.ip}:{service.port}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get host details from API</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">is_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_host_details</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">suppress_logs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No information found for IP </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">DotNotationObject</span><span class="p">({</span><span class="s2">&quot;services&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;leaks&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
        
        <span class="n">output_file</span><span class="p">,</span> <span class="n">should_close_file</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">services</span><span class="p">,</span> <span class="n">leaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_services_and_leaks</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="n">DotNotationObject</span><span class="p">({</span>
                <span class="s2">&quot;services&quot;</span><span class="p">:</span> <span class="n">services</span> <span class="k">if</span> <span class="n">services</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;leaks&quot;</span><span class="p">:</span> <span class="n">leaks</span> <span class="k">if</span> <span class="n">leaks</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">})</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Completed - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">services</span><span class="p">)</span><span class="si">}</span><span class="s2"> services, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">leaks</span><span class="p">)</span><span class="si">}</span><span class="s2"> leaks&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">output_file</span> <span class="ow">and</span> <span class="n">should_close_file</span><span class="p">:</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="LeakIX.get_domain">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.get_domain">[docs]</a>
    <span class="nd">@helpers</span><span class="o">.</span><span class="n">require_api_key</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get domain details for a specific domain name.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            domain (str): The domain name to query.</span>
<span class="sd">            fields (str, optional): Comma-separated list of fields to extract.</span>
<span class="sd">                                    Defaults to &quot;full&quot; to get all details.</span>
<span class="sd">            output (str or file object, optional): Path to file or file object to write results.</span>
<span class="sd">                                                   If None, results are only returned. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            DotNotationObject: Object with &#39;services&#39; and &#39;leaks&#39; attributes, each containing a list of L9Event objects.</span>
<span class="sd">                  Both can be None if no information was found.</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client = LeakIX()</span>
<span class="sd">            &gt;&gt;&gt; domain_info = client.get_domain(&quot;leakix.net&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Services: {len(domain_info.services or [])}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Leaks: {len(domain_info.leaks or [])}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; # Access service details</span>
<span class="sd">            &gt;&gt;&gt; if domain_info.services:</span>
<span class="sd">            ...     for service in domain_info.services:</span>
<span class="sd">            ...         print(f&quot;{service.protocol}://{service.host}:{service.port}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get domain details from API</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">is_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_domain_details</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">suppress_logs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No information found for domain </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">DotNotationObject</span><span class="p">({</span><span class="s2">&quot;services&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;leaks&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
        
        <span class="n">output_file</span><span class="p">,</span> <span class="n">should_close_file</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">services</span><span class="p">,</span> <span class="n">leaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_services_and_leaks</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="n">DotNotationObject</span><span class="p">({</span>
                <span class="s2">&quot;services&quot;</span><span class="p">:</span> <span class="n">services</span> <span class="k">if</span> <span class="n">services</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;leaks&quot;</span><span class="p">:</span> <span class="n">leaks</span> <span class="k">if</span> <span class="n">leaks</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">})</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Completed - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">services</span><span class="p">)</span><span class="si">}</span><span class="s2"> services, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">leaks</span><span class="p">)</span><span class="si">}</span><span class="s2"> leaks&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">output_file</span> <span class="ow">and</span> <span class="n">should_close_file</span><span class="p">:</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_deduplicate_subdomains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subdomains</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deduplicate subdomains by subdomain name (keep first occurrence).&quot;&quot;&quot;</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">unique_subdomains</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">subdomain</span> <span class="ow">in</span> <span class="n">subdomains</span><span class="p">:</span>
            <span class="n">subdomain_name</span> <span class="o">=</span> <span class="n">subdomain</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subdomain&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subdomain_name</span> <span class="ow">and</span> <span class="n">subdomain_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">subdomain_name</span><span class="p">)</span>
                <span class="n">unique_subdomains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdomain</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unique_subdomains</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if data indicates rate limiting and raise ValueError if so.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_rate_limited&#39;</span><span class="p">):</span>
            <span class="n">wait_seconds</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_wait_seconds&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limited. Wait </span><span class="si">{</span><span class="n">wait_seconds</span><span class="si">}</span><span class="s2"> seconds before retrying.&quot;</span><span class="p">)</span>
    
<div class="viewcode-block" id="LeakIX.get_subdomains">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.get_subdomains">[docs]</a>
    <span class="nd">@helpers</span><span class="o">.</span><span class="n">require_api_key</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_subdomains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get subdomains for a specific domain name.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            domain (str): The domain name to query.</span>
<span class="sd">            output (str or file object, optional): Path to file or file object to write results.</span>
<span class="sd">                                                   If None, results are only returned. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            list: List of DotNotationObject containing subdomain information.</span>
<span class="sd">                  Each object has &#39;subdomain&#39;, &#39;distinct_ips&#39;, and &#39;last_seen&#39; attributes.</span>
<span class="sd">                  Returns empty list if no subdomains found or on error.</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client = LeakIX()</span>
<span class="sd">            &gt;&gt;&gt; subdomains = client.get_subdomains(&quot;leakix.net&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Found {len(subdomains)} subdomains&quot;)</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            &gt;&gt;&gt; # Access subdomain details with dot notation</span>
<span class="sd">            &gt;&gt;&gt; for subdomain in subdomains:</span>
<span class="sd">            ...     print(f&quot;{subdomain.subdomain} - {subdomain.distinct_ips} IPs&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get subdomains from API</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">is_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_subdomains</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">suppress_logs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_rate_limit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No subdomains found for domain </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="n">output_file</span><span class="p">,</span> <span class="n">should_close_file</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subdomain</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">helpers</span><span class="o">.</span><span class="n">write_json_line</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">subdomain</span><span class="p">)</span>
            
            <span class="c1"># Convert list of dicts to list of DotNotationObject</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">DotNotationObject</span><span class="p">(</span><span class="n">subdomain</span><span class="p">)</span> <span class="k">for</span> <span class="n">subdomain</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Completed - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2"> subdomains&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">output_file</span> <span class="ow">and</span> <span class="n">should_close_file</span><span class="p">:</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="LeakIX.process_and_print_data">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.process_and_print_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_and_print_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">suppress_debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process the provided data, extract desired fields, and print the results.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (list or dict): Either a list of dictionaries or a single dictionary.</span>
<span class="sd">            fields (str or None): Comma-separated list of fields to extract.</span>
<span class="sd">            suppress_debug (bool): If True, suppress debug logs during processing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of dictionaries containing the extracted fields from the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Temporarily disable debug logging if suppress_debug is True</span>
        <span class="k">if</span> <span class="n">suppress_debug</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">process_and_format_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Pass None to disable logging</span>
        <span class="k">return</span> <span class="n">process_and_format_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_process_data_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">suppress_debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generator that processes data and yields events one by one as they are extracted.</span>
<span class="sd">        </span>
<span class="sd">        This allows for streaming processing where events are yielded immediately</span>
<span class="sd">        without waiting for the entire page to be processed.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            data (list or dict): Either a list of dictionaries or a single dictionary.</span>
<span class="sd">            fields (str or None): Comma-separated list of fields to extract.</span>
<span class="sd">            suppress_debug (bool): If True, suppress debug logs during processing.</span>
<span class="sd">        </span>
<span class="sd">        Yields:</span>
<span class="sd">            L9Event or dict: Processed events one by one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers.l9event</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">get_events_from_data</span><span class="p">,</span> <span class="n">extract_from_single_entry</span><span class="p">,</span> <span class="n">convert_to_l9event</span><span class="p">,</span>
            <span class="n">is_l9event_instance</span><span class="p">,</span> <span class="n">to_dict_if_l9event</span>
        <span class="p">)</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">_DEFAULT_FIELDS_LIST</span><span class="p">,</span> <span class="n">_PARSER_FULL_FIELD_REQUEST</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers.field_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">log_result_items</span>
        
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields_list</span> <span class="o">=</span> <span class="n">_DEFAULT_FIELDS_LIST</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
        
        <span class="n">events</span> <span class="o">=</span> <span class="n">get_events_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">suppress_debug</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
        <span class="n">is_full</span> <span class="o">=</span> <span class="n">_PARSER_FULL_FIELD_REQUEST</span> <span class="ow">in</span> <span class="n">fields_list</span>
        
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">convert_to_l9event</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_full</span> <span class="k">else</span> <span class="n">extract_from_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">fields_list</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
                <span class="n">log_result_items</span><span class="p">([</span><span class="n">event</span><span class="p">],</span> <span class="n">logger</span><span class="p">,</span> <span class="n">is_l9event_instance</span><span class="p">,</span> <span class="n">to_dict_if_l9event</span><span class="p">)</span>
            
            <span class="k">yield</span> <span class="n">event</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_process_bulk_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_param</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generator that processes bulk stream and yields events one by one as they arrive.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            query_param (str): The query string.</span>
<span class="sd">            fields (str or None): Comma-separated list of fields to extract.</span>
<span class="sd">            output_file (file object, optional): File handle to write results in real-time.</span>
<span class="sd">        </span>
<span class="sd">        Yields:</span>
<span class="sd">            L9Event: Events as they are processed from the bulk stream.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers.l9event</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">extract_from_single_entry</span><span class="p">,</span> <span class="n">convert_to_l9event</span><span class="p">,</span>
            <span class="n">is_l9event_instance</span><span class="p">,</span> <span class="n">to_dict_if_l9event</span>
        <span class="p">)</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">_DEFAULT_FIELDS_LIST</span><span class="p">,</span> <span class="n">_PARSER_FULL_FIELD_REQUEST</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.helpers.field_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">log_result_items</span>
        
        <span class="c1"># Check cache first</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="n">query_param</span><span class="p">}</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;/bulk/search&quot;</span>
        <span class="n">cached_data</span><span class="p">,</span> <span class="n">was_cached</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">with_cache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">was_cached</span><span class="p">:</span>
            <span class="c1"># Process cached data as a generator</span>
            <span class="k">if</span> <span class="n">cached_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_data_generator</span><span class="p">(</span><span class="n">cached_data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">suppress_debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                        <span class="n">helpers</span><span class="o">.</span><span class="n">write_result_item</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">event</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Opting for bulk search due to the availability of a Pro API Key.&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
        
        <span class="c1"># Make streaming request</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">make_api_request</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">BASE_URL</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_accept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># Parse fields</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields_list</span> <span class="o">=</span> <span class="n">_DEFAULT_FIELDS_LIST</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
        
        <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
        <span class="n">is_full</span> <span class="o">=</span> <span class="n">_PARSER_FULL_FIELD_REQUEST</span> <span class="ow">in</span> <span class="n">fields_list</span>
        <span class="n">all_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># For caching later</span>
        
        <span class="c1"># Stream and process events line by line</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_lines</span><span class="p">(</span><span class="n">decode_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="n">text</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)):</span>
                <span class="k">continue</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;events&quot;</span> <span class="ow">in</span> <span class="n">parsed</span><span class="p">:</span>
                    <span class="n">events_list</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="k">if</span> <span class="n">events_list</span><span class="p">:</span>
                        <span class="n">all_events</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">events_list</span><span class="p">)</span>
                        
                        <span class="c1"># Process and yield each event immediately</span>
                        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">events_list</span><span class="p">:</span>
                            <span class="n">event</span> <span class="o">=</span> <span class="n">convert_to_l9event</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_full</span> <span class="k">else</span> <span class="n">extract_from_single_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">fields_list</span><span class="p">)</span>
                            
                            <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
                                <span class="n">log_result_items</span><span class="p">([</span><span class="n">event</span><span class="p">],</span> <span class="n">logger</span><span class="p">,</span> <span class="n">is_l9event_instance</span><span class="p">,</span> <span class="n">to_dict_if_l9event</span><span class="p">)</span>
                            
                            <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                                <span class="n">helpers</span><span class="o">.</span><span class="n">write_result_item</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                            
                            <span class="k">yield</span> <span class="n">event</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">continue</span>
        
        <span class="c1"># Save to cache for future use</span>
        <span class="k">if</span> <span class="n">all_events</span><span class="p">:</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">save_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">all_events</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;No results returned from bulk query.&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="LeakIX.get_all_fields">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.get_all_fields">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">current_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all available field paths.</span>
<span class="sd">        </span>
<span class="sd">        If no data is provided, returns all fields from the l9format schema</span>
<span class="sd">        (no API call needed). If data is provided, extracts fields from that data.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (dict, optional): The nested dictionary to extract field paths from.</span>
<span class="sd">                                  If None, returns all fields from l9format schema.</span>
<span class="sd">            current_path (list, optional): Current path being traversed. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: A list of field paths sorted alphabetically.</span>
<span class="sd">            </span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Get all fields from schema (no API call needed)</span>
<span class="sd">            &gt;&gt;&gt; fields = client.get_all_fields()</span>
<span class="sd">            &gt;&gt;&gt; for field in sorted(fields):</span>
<span class="sd">            ...     print(field)</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; # Get fields from a specific event</span>
<span class="sd">            &gt;&gt;&gt; events = list(client.search(scope=&quot;leak&quot;, query=&#39;+country:&quot;France&quot;&#39;, pages=1))</span>
<span class="sd">            &gt;&gt;&gt; if events:</span>
<span class="sd">            ...     fields = client.get_all_fields(events[0])</span>
<span class="sd">            ...     for field in sorted(fields):</span>
<span class="sd">            ...         print(field)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Return fields from l9format schema (no API call needed)</span>
            <span class="k">return</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_all_fields_from_l9format_schema</span><span class="p">()</span>
        <span class="c1"># Extract fields from provided data</span>
        <span class="k">return</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_all_fields_from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">current_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="LeakIX.search">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.search">[docs]</a>
    <span class="nd">@helpers</span><span class="o">.</span><span class="n">require_api_key</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;leak&quot;</span><span class="p">,</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">pages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">plugin</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
        <span class="n">use_bulk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search LeakIX for data based on provided parameters.</span>
<span class="sd">        </span>
<span class="sd">        This is the main function for querying LeakIX. It returns a generator that streams</span>
<span class="sd">        events in real-time using HTTP streaming. Events are yielded as soon as they are</span>
<span class="sd">        received from the API, allowing you to process results immediately without waiting</span>
<span class="sd">        for all pages to be fetched.</span>
<span class="sd">        </span>
<span class="sd">        **Streaming Behavior:**</span>
<span class="sd">        </span>
<span class="sd">        - **Pagination mode** (default): Events are streamed page by page. Each page is fetched,</span>
<span class="sd">          processed, and events are yielded immediately. You don&#39;t wait for all pages</span>
<span class="sd">          before processing the first events. The `pages` parameter controls how many pages to fetch.</span>
<span class="sd">        - **Bulk mode** (`use_bulk=True`): Events are streamed line by line from the HTTP response using</span>
<span class="sd">          true HTTP streaming. Events are parsed and yielded as they arrive from the server.</span>
<span class="sd">          **Note:** In bulk mode, the `pages` parameter is ignored as all results are retrieved automatically.</span>
<span class="sd">        </span>
<span class="sd">        Optionally writes them to a file if `output` is specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            scope (str, optional): The scope of the search. Defaults to &quot;leak&quot;.</span>
<span class="sd">            query (str, optional): Search query string. Defaults to an empty string.</span>
<span class="sd">            pages (int, optional): Number of pages to scrape. Defaults to 2 (or LeakIX.DEFAULT_PAGES).</span>
<span class="sd">                                  **Note:** This parameter is ignored when `use_bulk=True` (bulk mode retrieves all results automatically).</span>
<span class="sd">            plugin (str, optional): Comma-separated plugin names. Defaults to an empty string.</span>
<span class="sd">            fields (str, optional): Comma-separated list of fields to extract from results. Defaults to &quot;full&quot; (all fields).</span>
<span class="sd">            use_bulk (bool, optional): Whether to use the bulk functionality (requires Pro API). </span>
<span class="sd">                                      When True, retrieves all results automatically and ignores the `pages` parameter. Defaults to False.</span>
<span class="sd">            output (str or file object, optional): Path to file or file object (e.g., sys.stdout) to write results. </span>
<span class="sd">                                                   If None, results are only returned. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            generator: A generator that yields L9Event objects in real-time via HTTP streaming.</span>
<span class="sd">                      Events are yielded as soon as they are received and processed.</span>
<span class="sd">                      If you need a list, use: list(client.search(...))</span>
<span class="sd">        </span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; # Stream events page by page (events processed as they arrive)</span>
<span class="sd">            &gt;&gt;&gt; events = client.search(scope=&quot;leak&quot;, query=&#39;+country:&quot;France&quot;&#39;, pages=5)</span>
<span class="sd">            &gt;&gt;&gt; for event in events:</span>
<span class="sd">            ...     print(event.ip)  # Events are streamed in real-time, no waiting for all pages</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; # Stream events with bulk mode (HTTP streaming, line by line)</span>
<span class="sd">            &gt;&gt;&gt; events = client.search(scope=&quot;leak&quot;, query=&#39;plugin:TraccarPlugin&#39;, use_bulk=True)</span>
<span class="sd">            &gt;&gt;&gt; for event in events:</span>
<span class="sd">            ...     print(event.ip)  # Events streamed directly from HTTP response</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; # Get all events as a list (if needed)</span>
<span class="sd">            &gt;&gt;&gt; events = list(client.search(scope=&quot;leak&quot;, query=&#39;+country:&quot;France&quot;&#39;, pages=2))</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; # Write to file while streaming (events still yielded)</span>
<span class="sd">            &gt;&gt;&gt; events = client.search(scope=&quot;leak&quot;, query=&#39;+country:&quot;France&quot;&#39;, pages=2, output=&quot;results.txt&quot;)</span>
<span class="sd">            &gt;&gt;&gt; for event in events:</span>
<span class="sd">            ...     print(event.ip)  # Events streamed and written to file simultaneously</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; # Stream to stdout (for piping)</span>
<span class="sd">            &gt;&gt;&gt; client.search(scope=&quot;leak&quot;, query=&#39;+country:&quot;France&quot;&#39;, pages=2, output=sys.stdout)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plugins_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_plugins</span><span class="p">()</span>
        <span class="n">given_plugins</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">plugin</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
        <span class="n">invalid_plugins</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">given_plugins</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">plugins_list</span><span class="p">)]</span>
        
        <span class="k">if</span> <span class="n">invalid_plugins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid plugins: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid_plugins</span><span class="p">)</span><span class="si">}</span><span class="s2">. Valid plugins: </span><span class="si">{</span><span class="n">plugins_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Use default pages if not specified</span>
        <span class="k">if</span> <span class="n">pages</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PAGES</span>
        
        <span class="n">output_file</span><span class="p">,</span> <span class="n">should_close_file</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing results in real-time to </span><span class="si">{</span><span class="n">output</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="nb">str</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;stdout&#39;</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fields_str</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">normalize_fields</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="c1"># Use the new generator-based query method</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_generator</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">pages</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">given_plugins</span><span class="p">,</span> <span class="n">fields_str</span><span class="p">,</span> <span class="n">use_bulk</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">output_file</span> <span class="ow">and</span> <span class="n">should_close_file</span><span class="p">:</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="LeakIX.query">
<a class="viewcode-back" href="../../api.html#leakpy.leakix.LeakIX.query">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scope</span><span class="p">,</span>
        <span class="n">pages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">query_param</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_bulk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">return_data_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a query on the LeakIX website based on provided criteria.</span>

<span class="sd">        Args:</span>
<span class="sd">            scope (str): The scope of the search.</span>
<span class="sd">            pages (int, optional): Number of pages to scrape. Defaults to LeakIX.DEFAULT_PAGES (2).</span>
<span class="sd">            query_param (str, optional): The query string to be used. Defaults to an empty string.</span>
<span class="sd">            plugins (list or str, optional): List or comma-separated string of plugin names. Defaults to None.</span>
<span class="sd">            fields (list of str or None, optional): List of fields to extract from the results.</span>
<span class="sd">            return_data_only (bool, optional): Return raw data only without processing. Defaults to False.</span>
<span class="sd">            use_bulk (bool, optional): Whether to use bulk mode. Defaults to False.</span>
<span class="sd">            output_file (file object, optional): File handle to write results in real-time. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: List of processed strings or raw data based on `return_data_only` flag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use default pages if not specified</span>
        <span class="k">if</span> <span class="n">pages</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PAGES</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">is_api_pro</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">is_api_pro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">check_privilege</span><span class="p">(</span><span class="s2">&quot;WpUserEnumHttp&quot;</span><span class="p">,</span> <span class="s2">&quot;leak&quot;</span><span class="p">)</span>

        <span class="c1"># Build query with plugins</span>
        <span class="n">query_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">build_query_with_plugins</span><span class="p">(</span><span class="n">query_param</span><span class="p">,</span> <span class="n">plugins</span><span class="p">)</span>
        
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="k">def</span><span class="w"> </span><span class="nf">log_execution_time</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Log execution time if not in silent mode.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution time: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>

        <span class="c1"># Use bulk mode if available and requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">is_api_pro</span> <span class="ow">and</span> <span class="n">use_bulk</span><span class="p">:</span>
            <span class="c1"># If writing to file, suppress all output except completion message</span>
            <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="n">original_silent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="c1"># Show spinner in bulk mode if not silent and not writing to file</span>
            <span class="n">use_progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_use_progress_bulk</span><span class="p">(</span><span class="n">return_data_only</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">use_progress</span><span class="p">:</span>
                    <span class="n">console</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_console_for_progress</span><span class="p">()</span>
                    <span class="n">original_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suppress_debug_logging</span><span class="p">()</span>
                    
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">Progress</span><span class="p">(</span>
                            <span class="n">SpinnerColumn</span><span class="p">(),</span>
                            <span class="n">TextColumn</span><span class="p">(</span><span class="s2">&quot;[progress.description]</span><span class="si">{task.description}</span><span class="s2">&quot;</span><span class="p">),</span>
                            <span class="n">transient</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">console</span><span class="o">=</span><span class="n">console</span><span class="p">,</span>
                        <span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                            <span class="n">task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;[cyan]Downloading and processing...&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                            
                            <span class="c1"># Call API without progress (API doesn&#39;t handle UI)</span>
                            <span class="n">data</span><span class="p">,</span> <span class="n">is_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">query_bulk</span><span class="p">(</span><span class="n">query_param</span><span class="p">,</span> <span class="n">suppress_logs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            
                            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;[cyan]Processing results...&quot;</span><span class="p">)</span>
                            
                            <span class="k">if</span> <span class="n">return_data_only</span><span class="p">:</span>
                                <span class="n">log_execution_time</span><span class="p">()</span>
                                <span class="k">return</span> <span class="n">data</span>
                            
                            <span class="c1"># Suppress debug logs during processing</span>
                            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_and_print_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">suppress_debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="p">[]</span>
                            
                            <span class="c1"># Write results to file if needed</span>
                            <span class="k">if</span> <span class="n">results</span> <span class="ow">and</span> <span class="n">output_file</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                                    <span class="n">helpers</span><span class="o">.</span><span class="n">write_result_item</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                            
                            <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
                                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;[green] Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results&quot;</span><span class="p">)</span>
                            
                            <span class="n">log_execution_time</span><span class="p">()</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_restore_logging_level</span><span class="p">(</span><span class="n">original_level</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">is_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">query_bulk</span><span class="p">(</span><span class="n">query_param</span><span class="p">,</span> <span class="n">suppress_logs</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">output_file</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">return_data_only</span><span class="p">:</span>
                        <span class="n">log_execution_time</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">data</span>
                    <span class="c1"># Suppress debug logs when writing to file</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_and_print_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">suppress_debug</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">output_file</span><span class="p">))</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="p">[]</span>
                    <span class="c1"># Write results to file if needed</span>
                    <span class="k">if</span> <span class="n">results</span> <span class="ow">and</span> <span class="n">output_file</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                            <span class="n">helpers</span><span class="o">.</span><span class="n">write_result_item</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                
                <span class="c1"># Restore silent state before showing completion message</span>
                <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">original_silent</span>
                
                <span class="c1"># Show completion message even when writing to file (but only if not silent)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="n">output_file</span> <span class="ow">and</span> <span class="n">results</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Completed - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
                
                <span class="n">log_execution_time</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">results</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Restore original silent state</span>
                <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">original_silent</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Regular paginated search</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">last_data</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># Show progress bar if not silent</span>
        <span class="n">use_progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_use_progress</span><span class="p">(</span><span class="n">return_data_only</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">use_progress</span><span class="p">:</span>
            <span class="c1"># Create a console for rich output that won&#39;t conflict with logging</span>
            <span class="n">console</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_console_for_progress</span><span class="p">()</span>
            
            <span class="c1"># Temporarily disable debug logging to avoid conflicts with progress bar</span>
            <span class="n">original_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suppress_debug_logging</span><span class="p">()</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">Progress</span><span class="p">(</span>
                    <span class="n">SpinnerColumn</span><span class="p">(),</span>
                    <span class="n">TextColumn</span><span class="p">(</span><span class="s2">&quot;[progress.description]</span><span class="si">{task.description}</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="n">BarColumn</span><span class="p">(),</span>
                    <span class="n">TaskProgressColumn</span><span class="p">(),</span>
                    <span class="n">transient</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">console</span><span class="o">=</span><span class="n">console</span><span class="p">,</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                    <span class="n">task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;[cyan]Fetching pages (0/</span><span class="si">{</span><span class="n">pages</span><span class="si">}</span><span class="s2">)...&quot;</span><span class="p">,</span> 
                        <span class="n">total</span><span class="o">=</span><span class="n">pages</span>
                    <span class="p">)</span>
                    
                    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
                        <span class="n">data</span><span class="p">,</span> <span class="n">is_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">query_search</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">query_param</span><span class="p">,</span> <span class="n">suppress_logs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="n">last_data</span> <span class="o">=</span> <span class="n">data</span>
                        <span class="c1"># Suppress debug logs during processing</span>
                        <span class="n">page_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_and_print_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">suppress_debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        
                        <span class="c1"># Process page results and write to file if needed</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">page_results</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">page_results</span><span class="p">:</span>
                                <span class="n">helpers</span><span class="o">.</span><span class="n">write_result_item</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                        
                        <span class="c1"># Update progress bar</span>
                        <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="n">task</span><span class="p">,</span> 
                            <span class="n">advance</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;[cyan]Fetching pages (</span><span class="si">{</span><span class="n">page</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pages</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results...&quot;</span>
                        <span class="p">)</span>
                        
                        <span class="c1"># Only respect rate limit if we made an actual API request</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_rate_limit_sleep</span><span class="p">(</span><span class="n">is_cached</span><span class="p">)</span>
                    
                    <span class="c1"># Final update</span>
                    <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="n">task</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;[green] Completed - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results&quot;</span>
                    <span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Restore original logging level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_restore_logging_level</span><span class="p">(</span><span class="n">original_level</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No progress bar, use simple logging</span>
            <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">is_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">query_search</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">query_param</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">last_data</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">page_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_and_print_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                
                <span class="c1"># Process page results and write to file if needed</span>
                <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">page_results</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">page_results</span><span class="p">:</span>
                        <span class="n">helpers</span><span class="o">.</span><span class="n">write_result_item</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                
                <span class="c1"># Only respect rate limit if we made an actual API request</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rate_limit_sleep</span><span class="p">(</span><span class="n">is_cached</span><span class="p">)</span>

        <span class="n">log_execution_time</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">last_data</span> <span class="k">if</span> <span class="n">return_data_only</span> <span class="k">else</span> <span class="n">results</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_query_generator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scope</span><span class="p">,</span>
        <span class="n">pages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">query_param</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_bulk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generator-based query that yields events page by page.</span>
<span class="sd">        </span>
<span class="sd">        This method yields events as soon as each page is processed,</span>
<span class="sd">        allowing for streaming processing of results.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            scope (str): The scope of the search.</span>
<span class="sd">            pages (int, optional): Number of pages to scrape. Defaults to LeakIX.DEFAULT_PAGES (2).</span>
<span class="sd">                                  **Note:** Ignored when `use_bulk=True` (bulk mode retrieves all results).</span>
<span class="sd">            query_param (str, optional): The query string to be used. Defaults to an empty string.</span>
<span class="sd">            plugins (list or str, optional): List or comma-separated string of plugin names. Defaults to None.</span>
<span class="sd">            fields (list of str or None, optional): List of fields to extract from the results.</span>
<span class="sd">            use_bulk (bool, optional): Whether to use bulk mode. When True, retrieves all results</span>
<span class="sd">                                      automatically and ignores `pages`. Defaults to False.</span>
<span class="sd">            output_file (file object, optional): File handle to write results in real-time. Defaults to None.</span>
<span class="sd">        </span>
<span class="sd">        Yields:</span>
<span class="sd">            L9Event: Events as they are processed from each page (or from bulk stream if use_bulk=True).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use default pages if not specified</span>
        <span class="k">if</span> <span class="n">pages</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PAGES</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">is_api_pro</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">is_api_pro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">check_privilege</span><span class="p">(</span><span class="s2">&quot;WpUserEnumHttp&quot;</span><span class="p">,</span> <span class="s2">&quot;leak&quot;</span><span class="p">)</span>

        <span class="c1"># Build query with plugins</span>
        <span class="n">query_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">build_query_with_plugins</span><span class="p">(</span><span class="n">query_param</span><span class="p">,</span> <span class="n">plugins</span><span class="p">)</span>
        
        <span class="c1"># Use bulk mode if available and requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">is_api_pro</span> <span class="ow">and</span> <span class="n">use_bulk</span><span class="p">:</span>
            <span class="c1"># Warn if pages is specified (bulk mode retrieves all results, pages is ignored)</span>
            <span class="c1"># Only warn if pages is explicitly set to a non-default value</span>
            <span class="k">if</span> <span class="n">pages</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_PAGES</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: &#39;pages&#39; parameter (</span><span class="si">{</span><span class="n">pages</span><span class="si">}</span><span class="s2">) is ignored in bulk mode. Bulk mode retrieves all results automatically.&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_bulk_stream</span><span class="p">(</span><span class="n">query_param</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">event</span>
            <span class="k">return</span>

        <span class="c1"># Regular paginated search - yield events as they are processed</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pages</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching page </span><span class="si">{</span><span class="n">page</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pages</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
            
            <span class="n">data</span><span class="p">,</span> <span class="n">is_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">query_search</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">query_param</span><span class="p">,</span> <span class="n">suppress_logs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No more data available at page </span><span class="si">{</span><span class="n">page</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            
            <span class="n">event_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_data_generator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">suppress_debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">):</span>
                <span class="n">event_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
                    <span class="n">helpers</span><span class="o">.</span><span class="n">write_result_item</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">event</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">page</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pages</span><span class="si">}</span><span class="s2"> processed: </span><span class="si">{</span><span class="n">event_count</span><span class="si">}</span><span class="s2"> events&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_rate_limit_sleep</span><span class="p">(</span><span class="n">is_cached</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, LeakPy Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>